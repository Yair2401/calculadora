<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“Š Calculadora de CampaÃ±as</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f9f9f9;
    }
    h2 {
      text-align: center;
      color: #333;
    }
    .form-container {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      max-width: 480px;
      margin: auto;
    }
    label {
      display: block;
      margin-top: 12px;
      font-weight: bold;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    button {
      margin-top: 15px;
      background: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    .resultados {
      background: #fff;
      padding: 20px;
      margin-top: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .ok { color: green; font-weight: bold; }
    .alerta { color: red; font-weight: bold; }
    small { color: #666; display: block; margin-bottom: 10px; }
  </style>
</head>
<body>

  <h2>ğŸ“Š Calculadora de CampaÃ±as</h2>

  <div class="form-container">
    <label for="tipo">âš™ï¸ Tipo de CampaÃ±a</label>
    <select id="tipo" onchange="mostrarCampos()">
      <option value="Bodega">Bodega</option>
      <option value="Dropshipping">Dropshipping</option>
    </select>

    <label for="gasto">ğŸ’° Gasto en Ads ($)</label>
    <input type="number" id="gasto" placeholder="Ej: 225717">

    <label for="conversaciones">ğŸ’¬ Conversaciones Iniciadas</label>
    <input type="number" id="conversaciones" placeholder="Ej: 570">

    <label for="ventas">ğŸ›’ NÃºmero de Ventas</label>
    <input type="number" id="ventas" placeholder="Ej: 6">

    <label for="unidades">ğŸ“¦ Cantidad de Unidades Vendidas</label>
    <input type="number" id="unidades" placeholder="Ej: 7">

    <label for="precio">ğŸ’µ Precio por Unidad ($)</label>
    <input type="number" id="precio" placeholder="Ej: 169900">

    <!-- Costos variables -->
    <div id="costoProductoDiv">
      <label for="costoProd">ğŸ·ï¸ Costo del Producto por Unidad ($)</label>
      <input type="number" id="costoProd" placeholder="Ej: 80000">
    </div>

    <div id="costoBodegaDiv">
      <label for="costoBodega">ğŸ¢ Costo de Bodega por Unidad ($)</label>
      <input type="number" id="costoBodega" placeholder="Ej: 5000">
    </div>

    <div id="costoEnvioDiv" style="display:none;">
      <label for="costoEnvio">ğŸšš Costo de EnvÃ­o por Unidad ($)</label>
      <input type="number" id="costoEnvio" placeholder="Ej: 10000">
    </div>

    <button onclick="calcular()">Calcular</button>
    <button onclick="descargarPDF()">ğŸ“¥ Descargar PDF</button>
  </div>

  <div class="resultados" id="resultados"></div>

  <script>
    function formatoCOP(valor) {
      return valor.toLocaleString('es-CO', { style: 'currency', currency: 'COP' });
    }

    function mostrarCampos() {
      let tipo = document.getElementById("tipo").value;
      document.getElementById("costoEnvioDiv").style.display = (tipo === "Dropshipping") ? "block" : "none";
    }

    function calcular() {
      let tipo = document.getElementById("tipo").value;
      let gasto = parseFloat(document.getElementById("gasto").value) || 0;
      let conversaciones = parseFloat(document.getElementById("conversaciones").value) || 0;
      let ventas = parseFloat(document.getElementById("ventas").value) || 0;
      let unidades = parseFloat(document.getElementById("unidades").value) || 0;
      let precio = parseFloat(document.getElementById("precio").value) || 0;
      let costoProd = parseFloat(document.getElementById("costoProd").value) || 0;
      let costoBodega = parseFloat(document.getElementById("costoBodega").value) || 0;
      let costoEnvio = tipo === "Dropshipping" ? (parseFloat(document.getElementById("costoEnvio").value) || 0) : 0;

      // CÃ¡lculos principales
      let costoConversacion = conversaciones > 0 ? gasto / conversaciones : 0;
      let tasaConversion = conversaciones > 0 ? (ventas / conversaciones) * 100 : 0;
      let ingresos = unidades * precio;
      let costoVenta = ventas > 0 ? gasto / ventas : 0;
      let costoUnidad = unidades > 0 ? gasto / unidades : 0;
      let roas = gasto > 0 ? ingresos / gasto : 0;

      // Costos totales de producto
      let costoTotalProductos = unidades * (costoProd + costoBodega + costoEnvio);

      // Utilidad neta y ganancia unitaria
      let utilidadNeta = ingresos - gasto - costoTotalProductos;
      let gananciaUnitaria = precio - (costoProd + costoBodega + costoEnvio);

      // Mensajes
      let mensaje = "";
      let consejo = "";

      if (roas < 1 || utilidadNeta < 0) {
        mensaje = `<span class="alerta">âŒ EstÃ¡s en pÃ©rdida, necesitas optimizar urgentemente.</span>`;
        consejo = "Reduce costos (producto, bodega o envÃ­o), mejora segmentaciÃ³n o sube el precio.";
      } else if (roas >= 1 && roas < 3) {
        mensaje = `<span class="alerta">âš ï¸ EstÃ¡s positivo pero aÃºn bajo en rentabilidad.</span>`;
        consejo = "Prueba nuevas audiencias y ajusta tu embudo de ventas para mejorar tu ROAS.";
      } else {
        mensaje = `<span class="ok">âœ… Â¡Ya estÃ¡s en un ROAS muy saludable!</span>`;
        consejo = "Escala la inversiÃ³n poco a poco y duplica lo que mejor te funciona.";
      }

      // Resultados
      let html = `<h3>ğŸ“ˆ Resultados (${tipo}):</h3>`;
      html += `<p><b>Costo por ConversaciÃ³n:</b> ${formatoCOP(costoConversacion)}<br>
               <small>(Promedio invertido para que una persona te escriba)</small></p>`;
      html += `<p><b>Tasa de ConversiÃ³n:</b> ${tasaConversion.toFixed(2)}%<br>
               <small>(Porcentaje de conversaciones que se convirtieron en clientes)</small></p>`;
      html += `<p><b>Ingresos Totales:</b> ${formatoCOP(ingresos)}<br>
               <small>(Dinero que entrÃ³ por ventas)</small></p>`;
      html += `<p><b>Costo por Venta:</b> ${formatoCOP(costoVenta)}<br>
               <small>(Publicidad invertida en promedio por cliente)</small></p>`;
      html += `<p><b>Costo por Unidad Vendida:</b> ${formatoCOP(costoUnidad)}<br>
               <small>(Publicidad invertida en promedio por producto)</small></p>`;
      html += `<p><b>ROAS:</b> ${roas.toFixed(2)}x<br>
               <small>(Por cada $1 en publicidad regresaron ${roas.toFixed(2)})</small></p>`;
      html += `<p><b>Ganancia Unitaria:</b> ${formatoCOP(gananciaUnitaria)}<br>
               <small>(Lo que queda por cada producto vendido)</small></p>`;
      html += `<p><b>Utilidad Neta Estimada:</b> ${formatoCOP(utilidadNeta)}<br>
               <small>(Ingresos â€“ Gasto en Ads â€“ Costos de producto, bodega y envÃ­o)</small></p>`;
      html += `<p>${mensaje}</p>`;
      html += `<p>ğŸ’¡ <b>Consejo:</b> ${consejo}</p>`;

      document.getElementById("resultados").innerHTML = html;
    }

    async function descargarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      let resultados = document.getElementById("resultados").innerText;
      doc.text("ğŸ“Š Resumen de la CampaÃ±a", 10, 10);
      doc.text(resultados, 10, 20);

      doc.save("resumen_campaÃ±a.pdf");
    }
  </script>

</body>
</html>
