<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üìä Calculadora de Campa√±as</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f9f9f9;
    }
    h2 {
      text-align: center;
      color: #333;
    }
    .form-container {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      max-width: 450px;
      margin: auto;
    }
    label {
      display: block;
      margin-top: 12px;
      font-weight: bold;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    button {
      margin-top: 15px;
      background: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    .resultados {
      background: #fff;
      padding: 20px;
      margin-top: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .ok { color: green; font-weight: bold; }
    .alerta { color: red; font-weight: bold; }
    .medio { color: orange; font-weight: bold; }
    small { color: #666; display: block; margin-bottom: 10px; }
    canvas {
      margin-top: 25px;
    }
    .semaforo {
      text-align: center;
      margin-top: 15px;
    }
    .luz {
      display: inline-block;
      width: 25px;
      height: 25px;
      border-radius: 50%;
      margin: 0 5px;
      background: #ccc;
    }
    .activo { box-shadow: 0 0 12px 4px rgba(0,0,0,0.3); }
    .rojo { background: red; }
    .amarillo { background: orange; }
    .verde { background: green; }
  </style>
</head>
<body>

  <h2>üìä Calculadora de Campa√±as</h2>

  <div class="form-container">
    <label for="tipo">‚öôÔ∏è Tipo de Campa√±a</label>
    <select id="tipo">
      <option value="Bodega">Bodega</option>
      <option value="Dropshipper">Dropshipper</option>
    </select>

    <label for="gasto">üí∞ Gasto en Ads ($)</label>
    <input type="number" id="gasto" placeholder="Ej: 225717">

    <label for="conversaciones">üí¨ Conversaciones Iniciadas</label>
    <input type="number" id="conversaciones" placeholder="Ej: 570">

    <label for="ventas">üõí N√∫mero de Ventas</label>
    <input type="number" id="ventas" placeholder="Ej: 6">

    <label for="unidades">üì¶ Cantidad de Unidades Vendidas</label>
    <input type="number" id="unidades" placeholder="Ej: 7">

    <label for="precio">üíµ Precio por Unidad ($)</label>
    <input type="number" id="precio" placeholder="Ej: 169900">

    <label for="costoProd">üè∑Ô∏è Costo del Producto por Unidad ($)</label>
    <input type="number" id="costoProd" placeholder="Ej: 80000">

    <button onclick="calcular()">Calcular</button>
  </div>

  <div class="resultados" id="resultados"></div>

  <div class="semaforo">
    <div id="rojo" class="luz rojo"></div>
    <div id="amarillo" class="luz amarillo"></div>
    <div id="verde" class="luz verde"></div>
  </div>

  <canvas id="grafico"></canvas>

  <!-- Librer√≠a Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    let chart; // referencia global al gr√°fico

    function formatoCOP(valor) {
      return valor.toLocaleString('es-CO', { style: 'currency', currency: 'COP' });
    }

    function calcular() {
      let tipo = document.getElementById("tipo").value;
      let gasto = parseFloat(document.getElementById("gasto").value) || 0;
      let conversaciones = parseFloat(document.getElementById("conversaciones").value) || 0;
      let ventas = parseFloat(document.getElementById("ventas").value) || 0;
      let unidades = parseFloat(document.getElementById("unidades").value) || 0;
      let precio = parseFloat(document.getElementById("precio").value) || 0;
      let costoProd = parseFloat(document.getElementById("costoProd").value) || 0;

      let costoConversacion = conversaciones > 0 ? gasto / conversaciones : 0;
      let tasaConversion = conversaciones > 0 ? (ventas / conversaciones) * 100 : 0;
      let ingresos = unidades * precio;
      let costoVenta = ventas > 0 ? gasto / ventas : 0;
      let costoUnidad = unidades > 0 ? gasto / unidades : 0;
      let roas = gasto > 0 ? ingresos / gasto : 0;
      let utilidadNeta = ingresos - gasto - (unidades * costoProd);

      let mensaje = "";
      let consejo = "";

      if (roas < 1) {
        mensaje = `<span class="alerta">‚ùå Est√°s en p√©rdida, necesitas optimizar urgentemente.</span>`;
        consejo = "Reduce costos en ads, mejora tu segmentaci√≥n o ajusta el precio de venta.";
        setSemaforo("rojo");
      } else if (roas >= 1 && roas < 3) {
        mensaje = `<span class="medio">‚ö†Ô∏è Est√°s positivo pero a√∫n bajo en rentabilidad.</span>`;
        consejo = "Prueba nuevas audiencias y optimiza el embudo de ventas para mejorar tu ROAS.";
        setSemaforo("amarillo");
      } else {
        mensaje = `<span class="ok">‚úÖ ¬°Ya est√°s en un ROAS muy saludable!</span>`;
        consejo = "Escala la inversi√≥n poco a poco y duplica las audiencias que mejor convierten.";
        setSemaforo("verde");
      }

      let html = `<h3>üìà Resultados (${tipo}):</h3>`;
      html += `<p><b>Costo por Conversaci√≥n:</b> ${formatoCOP(costoConversacion)}<br>
               <small>(Lo que pagaste en publicidad para que una persona te escribiera)</small></p>`;
      html += `<p><b>Tasa de Conversi√≥n:</b> ${tasaConversion.toFixed(2)}%<br>
               <small>(Porcentaje de conversaciones que se convirtieron en clientes)</small></p>`;
      html += `<p><b>Ingresos Totales:</b> ${formatoCOP(ingresos)}<br>
               <small>(Todo el dinero que entr√≥ por ventas en esta campa√±a)</small></p>`;
      html += `<p><b>Costo por Venta:</b> ${formatoCOP(costoVenta)}<br>
               <small>(Promedio gastado en publicidad para conseguir un cliente)</small></p>`;
      html += `<p><b>Costo por Unidad Vendida:</b> ${formatoCOP(costoUnidad)}<br>
               <small>(Publicidad invertida en promedio por cada producto vendido)</small></p>`;
      html += `<p><b>ROAS:</b> ${roas.toFixed(2)}x<br>
               <small>(Por cada $1 en publicidad, regresaron ${roas.toFixed(2)} en ventas)</small></p>`;
      html += `<p><b>Unidades Vendidas:</b> ${unidades}<br>
               <small>(Cantidad total de productos colocados en esta campa√±a)</small></p>`;
      html += `<p><b>Utilidad Neta Estimada:</b> ${formatoCOP(utilidadNeta)}<br>
               <small>(Ingresos ‚Äì Gasto en Ads ‚Äì Costos de producto)</small></p>`;
      html += `<p>${mensaje}</p>`;
      html += `<p>üí° <b>Consejo:</b> ${consejo}</p>`;

      document.getElementById("resultados").innerHTML = html;

      // Crear/actualizar gr√°fico
      const ctx = document.getElementById('grafico').getContext('2d');
      if (chart) chart.destroy(); // destruye gr√°fico anterior
      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Gasto en Ads', 'Ingresos Totales', 'Utilidad Neta'],
          datasets: [{
            label: 'Pesos Colombianos',
            data: [gasto, ingresos, utilidadNeta],
            backgroundColor: ['#ff4d4d','#4CAF50','#007bff']
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return formatoCOP(context.raw);
                }
              }
            }
          },
          scales: {
            y: {
              ticks: {
                callback: function(value) { return formatoCOP(value); }
              }
            }
          }
        }
      });
    }

    // Control del sem√°foro
    function setSemaforo(color) {
      document.getElementById("rojo").classList.remove("activo");
      document.getElementById("amarillo").classList.remove("activo");
      document.getElementById("verde").classList.remove("activo");
      document.getElementById(color).classList.add("activo");
    }
  </script>

</body>
</html>
